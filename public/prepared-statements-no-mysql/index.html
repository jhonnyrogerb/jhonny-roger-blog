<!DOCTYPE html>
<html>
<head>
	<title>Sejedev - "Seje" dev, não seja sobrinho!</title>
	<meta charset="utf-8">
  	<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

	<link rel="stylesheet" type="text/css" href="http://localhost/jhonny-roger/public/css/style.min.css?1500245854">
	<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
	<script>
	  (adsbygoogle = window.adsbygoogle || []).push({
	    google_ad_client: "ca-pub-9403183739906461",
	    enable_page_level_ads: true
	  });
	</script>
</head>
<body>
	<header id="sd-header">
		<a href="http://localhost/jhonny-roger/public/" id="sd-logo">Sejedev</a>
		<nav id="sd-nav-menu">
			<ul>
				<li><a href="http://localhost/jhonny-roger/public/categories/nodejs">Artigos</a></li>
				<li><a href="http://localhost/jhonny-roger/public/categories/jquery">Noticias</a></li>
				<li><a href="http://localhost/jhonny-roger/public/categories/jquery">Projetos</a></li>
				<li><a href="http://localhost/jhonny-roger/public/categories/jquery">Colabore</a></li>
			</ul>
		</nav>
		<form action="#" id="sd-search-form">
			<input type="search" name="search" placeholder="Faça a sua busca!">
		</form>
	</header>
<section id="sd-main-post">
    
    <h1>
        <a href="/jhonny-roger/public/frontend-week/">
            Front-end Week
        </a>
    </h1>
    <p class="sd-main-excerpt">
         Uma overdose de eventos e palestras sobre front-end em uma semana. 
    </p>
    <p class="sd-main-author">
        por <a href="/jhonny-roger/public/author/diego-eis">Diego Eis"</a>27/06/2017
    </p>
    
</section>



<div class="tb-post">

  <section class="tb-post-content">
    <article class="tb-post-article">
      

<p>Para quem adora padronização e organização, no MySQL existe o recurso chamado <strong>Prepared Statements</strong>.</p>

<p>Imagine a seguinte situação: você precisa criar uma procedure que faça todas as consultas em todas as entidades do seu banco e outra que apenas inserções e assim por diante&#8230; Uma para cada DML (data manipulation language) tudo passando por parametros, esse é o statement prepare.</p>

<p>Resumidamente você prepara a query antes de executa-lá no banco de dados, então vamos colocar a mão na massa e mostrar esse recurso.</p>

<h2 id="criando-o-usuário">Criando o usuário</h2>

<p>O primeiro passo é criar um usuário no banco de dados que tenha permissão para executar rotinas. Eu que trabalho sempre com stored procedures utilizo apenas o EXECUTE, mas se você trabalha com DMLs diretas nas aplicações, pode criar diversas permissões ou um usuário com todos os privilégios (ALL PRIVILEGES).</p>

<p><strong>Segue abaixo o exemplo de EXECUTE:</strong></p>

<pre class="lang-sql">GRANT EXECUTE 
ON *.*
TO layo.azevedo@localhost IDENTIFIED BY 'w9QSK4yD' WITH GRANT OPTION;</pre>

<p><strong>Segue abaixo o exemplo de um ALL PRIVILEGES:</strong></p>

<pre class="lang-sql">GRANT ALL PRIVILEGES
ON *.*
TO layo.azevedo@localhost IDENTIFIED BY 'w9QSK4yD' WITH GRANT OPTION;</pre>

<p><strong>ESSES FORAM OS COMANDOS PARA CRIAR UM USUARIO:</strong></p>

<p><strong>GRANT</strong> &#8211; CRIA USUARIO</p>

<p><strong>EXECUTE</strong> &#8211; EXECUTA APENAS ROTINAS</p>

<p><strong>ALL PRIVILEGES</strong> &#8211; PERMITE EXECUTAR TUDO NO BANCO DE DADOS</p>

<p><strong>*.*</strong> &#8211; O PRIVILEGIO APLICA-SE A TODAS AS BASES</p>

<p><strong>IDENTIFIED BY</strong> &#8211; É A SUA SENHA</p>

<p><strong>WITH GRANT OPTION</strong> &#8211; O USUARIO PODE CRIAR DIVERSOS USUARIOS E CONCEDER PRIVILEGIOS A ELE.</p>

<p>Sinceramente eu aconselho trabalhar com o EXECUTE. Com ele é difícil de tentarem injection sql.</p>

<p>Agora que criamos o usuario <strong>layo.azevedo@localhost</strong> vou criar uma procedure com a função de executar qualquer select no MySQL, começando com o delimitador do código para não parar quando o MySQL achar o sinal de &#8216;;&#8217; (ponto vírgula):</p>

<pre class="lang-sql">DELIMITER $$
$$</pre>

<p>Dentro do DELIMITER colocamos a procedure com o nome de SelectGeral com três parâmetros: nome da tabela, condição e valor:</p>

<p><strong>1 &#8211;</strong> Chamarei tabela de p_tabela, condição de p_condicao e valor de p_valor (lembre-se que o MySQL é fortemente tipado então coloque o tipo se é VARCHAR, CHAR, INT, etc&#8230;)</p>

<pre class="lang-sql">DELIMITER $$

create procedure SelectGeral (p_tabela(VARCHAR(20), p_condicao(VARCHAR(10), p_valor (VARCHAR(30)) 
BEGIN

END
$$</pre>

<p>Proximo passo é criar uma variável para executar a query dentro do banco. Nesse caso usaremos o SET juntamente com o comando CONCAT para concatenarmos os dados.</p>

<pre class="lang-sql">DELIMITER $$

create procedure SelectGeral (p_tabela VARCHAR(20), p_condicao VARCHAR(10), p_valor VARCHAR(30))
BEGIN
SET @Variavel = CONCAT('SELECT * from  ', p_tabela,' WHERE ', p_condicao , ' = ''' ,p_valor,'''');
END
$$</pre>

<p>O último passo é executar a variável:</p>

<pre class="lang-sql">DELIMITER $$

create procedure SelectGeral (p_tabela VARCHAR(20), p_condicao VARCHAR(10), p_valor VARCHAR(30))
BEGIN
SET @Variavel = CONCAT('SELECT * from  ', p_tabela,' WHERE ', p_condicao , ' = ''' ,p_valor,'''');
PREPARE consulta_geral FROM @Variavel ;
EXECUTE consulta_geral;
END
$$</pre>

<p>Pronto criamos a procedure SelectGeral com o Prepared Statements. Para visualizar basta executar o seguinte comando:</p>

<pre class="lang-sql">CALL SelectGeral ('usuario', 'nome', 'layo.azevedo');</pre>

<p>Ou seja seria essa query = <strong>SELECT * from usuario WHERE  nome = &#8216;layo.azevedo&#8217;</strong></p>

<p>Esse foi um exemplo bem básico, mostrando o caminho das pedras para iniciantes que tenham alguma dúvida sobre Prepared Statements.</p>

    </article>

    <div class="tb-related-posts">
      <h3>Leia mais:</h3>
      <ul>
        
        <li class="tb-related-post">
          <a href="/jhonny-roger/public/velocidade-tableless-estatico//?utm_source=tablelessRelatedLin">Performance do Tableless estático</a><br />
        </li>

        
        <li class="tb-related-post">
          <a href="/jhonny-roger/public/teste-de-carga-em-apis-utilizando-artillery//?utm_source=tablelessRelatedLin">Teste de carga em APIs utilizando Artillery</a><br />
        </li>

        
        <li class="tb-related-post">
          <a href="/jhonny-roger/public/o-que-aprendi-em-5-dias-como-front-end--e-uma-pergunta-voce-esta-preparado-para-se-tornar-um-desenvolvedor//?utm_source=tablelessRelatedLin">O que aprendi em 5 dias como Front-end, e uma pergunta: você esta preparado para se tornar um desenvolvedor?</a><br />
        </li>

        
      </ul>
    </div>

  </section>
</div>

<footer id="sd-footer">
</footer>

<script src="https://code.jquery.com/jquery-3.2.1.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
<script type="text/javascript" src="http://localhost/jhonny-roger/public/js/main.js?1500245854"></script>