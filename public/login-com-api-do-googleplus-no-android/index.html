<!DOCTYPE html>
<html>
<head>
	<title>Sejedev - "Seje" dev, não seja sobrinho!</title>
	<meta charset="utf-8">
  	<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

	<link rel="stylesheet" type="text/css" href="http://localhost/jhonny-roger/public/css/style.min.css?1500245841">
	<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
	<script>
	  (adsbygoogle = window.adsbygoogle || []).push({
	    google_ad_client: "ca-pub-9403183739906461",
	    enable_page_level_ads: true
	  });
	</script>
</head>
<body>
	<header id="sd-header">
		<a href="http://localhost/jhonny-roger/public/" id="sd-logo">Sejedev</a>
		<nav id="sd-nav-menu">
			<ul>
				<li><a href="http://localhost/jhonny-roger/public/categories/nodejs">Artigos</a></li>
				<li><a href="http://localhost/jhonny-roger/public/categories/jquery">Noticias</a></li>
				<li><a href="http://localhost/jhonny-roger/public/categories/jquery">Projetos</a></li>
				<li><a href="http://localhost/jhonny-roger/public/categories/jquery">Colabore</a></li>
			</ul>
		</nav>
		<form action="#" id="sd-search-form">
			<input type="search" name="search" placeholder="Faça a sua busca!">
		</form>
	</header>
<section id="sd-main-post">
    
    <h1>
        <a href="/jhonny-roger/public/frontend-week/">
            Front-end Week
        </a>
    </h1>
    <p class="sd-main-excerpt">
         Uma overdose de eventos e palestras sobre front-end em uma semana. 
    </p>
    <p class="sd-main-author">
        por <a href="/jhonny-roger/public/author/diego-eis">Diego Eis"</a>27/06/2017
    </p>
    
</section>



<div class="tb-post">

  <section class="tb-post-content">
    <article class="tb-post-article">
      

<p>Temos uma opção bastante útil hoje em dia no Android, que é usar a sincronização da conta de e-mail do Google.</p>

<p>Não vou alongar muito a introdução, vamos partir para a codificação e configuração da API.</p>

<h2 id="criando-um-novo-projeto-no-androidstudio">Criando um novo Projeto no AndroidStudio</h2>

<p><a href="http://tableless.com.br/uploads/2016/01/1.png"><img class="alignnone size-full wp-image-52732" src="http://tableless.com.br/uploads/2016/01/1.png" alt="1" width="472" height="326" /></a></p>

<p>Digite o <strong>nome</strong> da aplicação e escolha também um nome do <strong>package</strong>, vamos precisar para ativar a API do GooglePlus no <strong>Console do Google.</strong> Continuei a criação e escolha uma <strong>Empty</strong> <strong>Activity</strong>.</p>

<h2 id="configuração-no-console-do-google-e-ativação-da-api">Configuração no Console do Google e Ativação da API</h2>

<p>Tenho que informar que essa é a parte mais chata do tutorial, mas enfim com pouco de paciência e atenção vamos conseguir.</p>

<p>Acesse o link para configurar <a href="https://developers.google.com/mobile/add?platform=android&cntapi=signin&cnturl=https:%2F%2Fdevelopers.google.com%2Fidentity%2Fsign-in%2Fandroid%2Fsign-in%3Fconfigured%3Dtrue&cntlbl=Continue%20Adding%20Sign-In" target="_blank">Console Configuração</a>. Você irá ver algo parecido com isso:</p>

<p><a href="http://tableless.com.br/uploads/2016/01/c1.png"><img class="alignnone size-full wp-image-52724" src="http://tableless.com.br/uploads/2016/01/c1.png" alt="c1" width="600" height="337" /></a></p>

<ol>
<li>Adicione o <strong>nome</strong> para a sua aplicação (Sugiro que seja o mesmo nome que Adicionou no seu App).</li>
<li>Adicione o nome do <strong>package</strong> (Você pode encontrar esse nome no seu <strong>AndroidManisfest.xml</strong> ou no seu <strong>Gradle app-level</strong> escrito <strong>applicationId</strong>).</li>
<li>Escolha sua Região.</li>
<li>Continue (Choose and configure services).</li>
</ol>

<p>Feito, vai ser redirecionado a uma página e irar visualizar um campo vazio, lá você vai digitar o seu <strong>SHA-1</strong>. Porém como obter meu SHA-1? Você vai ter que acessar via linha de comando a pasta (<strong>.android</strong>) normalmente ela fica localizada na raiz  (<strong>C:\Users\NomeUsuario.android</strong>)  dentro você vai perceber um arquivo (chave chamada <strong>debug.keystore</strong> ),<strong> </strong>quando achar digite o seguinte comando na pasta:</p>

<pre>keytool -list -v -keystore debug.keystore -alias androiddebugkey -storepass android -keypass android</pre>

<p><a href="http://tableless.com.br/uploads/2016/01/cmd.png"><img class="alignnone size-full wp-image-52729" src="http://tableless.com.br/uploads/2016/01/cmd.png" alt="cmd" width="956" height="537" /></a></p>

<p>Caso você não consiga acesse o link para mais informações <a href="https://developers.google.com/android/guides/client-auth" target="_blank">obter SHA-1</a>. Agora copie e cole o SHA-1 no Console do Google e você terá algo:</p>

<p><a href="http://tableless.com.br/uploads/2016/01/c3.png"><img class="alignnone size-full wp-image-52730" src="http://tableless.com.br/uploads/2016/01/c3.png" alt="c3" width="700" height="361" /></a></p>

<p>Agora continue (Continue to Generate configuration files). Gere o arquivo, faça o download depois copie e cole na raiz do seu projeto exemplo (C:\Users\Alessandro\AndroidstudioProjects\GoogleSign-In\app).</p>

<p><a href="http://tableless.com.br/uploads/2016/01/Sem-títulooo.png"><img class="alignnone size-full wp-image-52731" src="http://tableless.com.br/uploads/2016/01/Sem-títulooo.png" alt="Sem títulooo" width="600" height="337" /></a></p>

<h2 id="voltando-para-nosso-projeto-no-androidstudio">Voltando para nosso Projeto no AndroidStudio</h2>

<p>Feito as devidas configurações no <strong>Console do Google</strong>, vamos configurar o Build Gradle o suporte <strong>Play Services</strong> na nossa aplicação.</p>

<ol>
<li>Adicione a dependência no <strong>project-level</strong> build.gradle:</li>
</ol>

<pre>classpath 'com.google.gms:google-services:1.5.0-beta2'</pre>

<ol>
<li>Adicione o plugin e dependência no <strong>app-level</strong> build.gradle e o Play services Auth:</li>
</ol>

<pre>apply plugin: 'com.google.gms.google-services'</pre>

<pre>compile 'com.google.android.gms:play-services-auth:8.3.0'</pre>

<p><a href="http://tableless.com.br/uploads/2016/01/teste.png"><img class="alignnone size-full wp-image-52733" src="http://tableless.com.br/uploads/2016/01/teste.png" alt="teste" width="956" height="538" /></a></p>

<h2 id="arquivo-de-layout">Arquivo de Layout</h2>

<p>No arquivo de layout <strong>activity_main.xml </strong>adicione:</p>

<pre class="lang-xml">&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;LinearLayout
    xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:tools="http://schemas.android.com/tools"
    android:layout_width="match_parent"
    android:layout_height="match_parent"
    tools:context="barreto.alessandro.googlesign_in.MainActivity"
    android:orientation="vertical"&gt;

    &lt;RelativeLayout
        android:padding="10dp"
        android:background="#1f737373"
        android:layout_width="match_parent"
        android:layout_height="wrap_content"&gt;

        &lt;ImageView
            android:src="@mipmap/ic_launcher"
            android:id="@+id/ivUsuario"
            android:layout_width="100dp"
            android:layout_height="100dp"
            android:layout_centerHorizontal="true" /&gt;

        &lt;TextView
            android:layout_marginTop="8dp"
            android:text="Android Teste"
            android:layout_centerHorizontal="true"
            android:textAppearance="?android:attr/textAppearanceLarge"
            android:layout_below="@+id/ivUsuario"
            android:id="@+id/tvNome"
            android:layout_width="wrap_content"
            android:layout_height="wrap_content" /&gt;

        &lt;TextView
            android:layout_marginTop="5dp"
            android:layout_centerHorizontal="true"
            android:layout_below="@+id/tvNome"
            android:text="androidteste@gmail.com"
            android:id="@+id/tvEmail"
            android:layout_width="wrap_content"
            android:layout_height="wrap_content"
            android:textAppearance="?android:attr/textAppearanceMedium"/&gt;

    &lt;/RelativeLayout&gt;

    &lt;LinearLayout
        android:orientation="vertical"
        android:layout_marginTop="16dp"
        android:layout_gravity="center_horizontal"
        android:padding="16dp"
        android:layout_width="match_parent"
        android:layout_height="wrap_content"&gt;

        &lt;com.google.android.gms.common.SignInButton
            android:id="@+id/sign_in_button"
            android:layout_width="match_parent"
            android:layout_height="wrap_content" /&gt;

        &lt;Button
            android:id="@+id/btnDesconectar"
            android:layout_marginTop="10dp"
            android:text="Desconectar"
            android:layout_width="match_parent"
            android:layout_height="wrap_content" /&gt;

        &lt;Button
            android:id="@+id/btnRevogar"
            android:layout_marginTop="10dp"
            android:text="Revogar acesso"
            android:layout_width="match_parent"
            android:layout_height="wrap_content" /&gt;

    &lt;/LinearLayout&gt;
&lt;/LinearLayout&gt;
</pre>

<p>Sem muito comentário sobre o código acima, ele possui:</p>

<ul>
<li>Um <strong>ImageView</strong> para imagem do usuário.</li>
<li>Dois <strong>TextView</strong> para nome e e-mail.</li>
<li>Três <strong>Buttons</strong> sendo que um customizado, vão servir para Login, Desconectar, Revogar o Acesso do usuário</li>
</ul>

<h2 id="a-class-principal">A Class Principal</h2>

<p>Agora vamos fazer o vinculo entre o XML e Java API (<strong>bindViews</strong>). Crie um método chamado <strong>bindViews</strong> e adicione:</p>

<pre class="lang-java">/**
     * Metodo para fazer o vinculo entre o xml e java api
     */
    private void bindViews(){
        ivUsuario       = (ImageView)findViewById(R.id.ivUsuario);
        tvNome          = (TextView)findViewById(R.id.tvNome);
        tvEmail         = (TextView)findViewById(R.id.tvEmail);
        btnDesconectar  = (Button)findViewById(R.id.btnDesconectar);
        btnRevogar      = (Button)findViewById(R.id.btnRevogar);
        signInButton    = (SignInButton) findViewById(R.id.sign_in_button);
        // litener de clicks
        signInButton.setOnClickListener(this);
        btnDesconectar.setOnClickListener(this);
        btnRevogar.setOnClickListener(this);
    }
</pre>

<p>Vamos solicitar da API informações simples de um login como nome, e-mail, foto e id, no momento é o que necessitamos para esse exemplo.</p>

<p>Temos que utilizar o objeto <strong>GoogleSignOptions </strong>e passar como parâmetro <strong>GoogleSignOptions.DEFAULT_SIGN_IN</strong> nele contem a opção <strong>requestEmail()</strong>.</p>

<pre class="lang-java">GoogleSignInOptions gso = new GoogleSignInOptions.Builder(GoogleSignInOptions.DEFAULT_SIGN_IN)
                .requestEmail()
                .build();
</pre>

<p>Agora que já temos configurado nossa solicitação, iremos criar um objeto GoogleApiClient com acesso ao login do Google API e as opções especificadas. Colocando tudo em um método que chamei de obterConfiguracoesPadraoLogin() .</p>

<pre class="lang-java">/**
     * Metodo para fazer as primeiras requisições da API para login simples
     */
    private void obterConfiguracoesPadraoLogin(){
        GoogleSignInOptions gso = new GoogleSignInOptions.Builder(GoogleSignInOptions.DEFAULT_SIGN_IN)
                .requestEmail()
                .build();

        mGoogleApiClient = new GoogleApiClient.Builder(this)
                .enableAutoManage(this,this)
                .addApi(Auth.GOOGLE_SIGN_IN_API, gso)
                .build();

    }
</pre>

<p>Agora a <strong>intenção</strong> de login usando uma <strong>Intent do Android</strong> com o método getSignInIntent e passando para o <strong>startActivityForResult</strong>.</p>

<pre class="lang-java">/**
     * metodo para inicar o login
     */
    private void signIn() {
        Intent signInIntent = Auth.GoogleSignInApi.getSignInIntent(mGoogleApiClient);
        startActivityForResult(signInIntent, SIGN_IN);
    }

    @Override
    public void onClick(View v) {
        switch (v.getId()) {
            case R.id.sign_in_button:
                signIn();
                break;
            // ...
        }
    }
</pre>

<p>Apos isso o método <strong>onActivityResult </strong>será chamado com nossos resultados e para recuperar utilizamos o <strong>getSignInResultFromIntent</strong>.</p>

<pre class="lang-java">@Override
    public void onActivityResult(int requestCode, int resultCode, Intent data) {
        super.onActivityResult(requestCode, resultCode, data);

        if (requestCode == SIGN_IN) {
            GoogleSignInResult resultado = Auth.GoogleSignInApi.getSignInResultFromIntent(data);
            if (resultado.isSuccess()){
                GoogleSignInAccount acct = resultado.getSignInAccount();
                obterInfoGoogle(acct);
            }
        }
    }
</pre>

<p>Depois de recuperar o resultado, você pode verificar se a solicitação  deu certo com o método <strong>isSuccess</strong> . Se bem-sucedido, você pode chamar o método <strong>getSignInAccount</strong> para obter um objeto <strong>GoogleSignInAccount</strong> que contém informações sobre o usuário.</p>

<pre class="lang-java">private void obterInfoGoogle(GoogleSignInAccount acct){
        String nome = acct.getDisplayName();
        tvNome.setText(nome);
        String email = acct.getEmail();
        tvEmail.setText(email);
        String id = acct.getId();
        Log.i(TAG,"ID do usuário no GooglePlus "+id);
        String urlFoto = acct.getPhotoUrl().toString();
        Picasso.with(MainActivity.this).load(urlFoto).resize(100,100).into(ivUsuario);
    }
</pre>

<p>Utilizei a lib <a href="http://square.github.io/picasso/" target="_blank">Picasso</a> para o carregamento eficiente de imagem, adicione no seu <strong>Gradle app-level</strong>.</p>

<pre>compile 'com.squareup.picasso:picasso:2.5.2'
</pre>

<p>No <strong>AndroidManifest.xml</strong></p>

<pre>&lt;uses-permission android:name="android.permission.INTERNET"/&gt;
</pre>

<p>.Agora segue toda a Class <strong>MainActivity</strong></p>

<pre class="lang-java">package barreto.alessandro.googlesign_in;

import android.content.Intent;
import android.support.v7.app.AppCompatActivity;
import android.os.Bundle;
import android.util.Log;
import android.view.View;
import android.widget.Button;
import android.widget.ImageView;
import android.widget.TextView;

import com.google.android.gms.auth.api.Auth;
import com.google.android.gms.auth.api.signin.GoogleSignInAccount;
import com.google.android.gms.auth.api.signin.GoogleSignInOptions;
import com.google.android.gms.auth.api.signin.GoogleSignInResult;
import com.google.android.gms.common.ConnectionResult;
import com.google.android.gms.common.SignInButton;
import com.google.android.gms.common.api.GoogleApiClient;
import com.google.android.gms.common.api.ResultCallback;
import com.google.android.gms.common.api.Status;
import com.squareup.picasso.Picasso;

public class MainActivity extends AppCompatActivity implements GoogleApiClient.OnConnectionFailedListener, View.OnClickListener {

    private static final String TAG = "TAG";
    private static final int SIGN_IN = 10;

    private ImageView ivUsuario;
    private TextView tvNome,tvEmail;
    private Button btnDesconectar,btnRevogar;
    private SignInButton signInButton;

    private GoogleApiClient mGoogleApiClient;

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);

        bindViews();
        obterConfiguracoesPadraoLogin();

    }

    /**
     * Metodo para fazer o vinculo entre o xml e java api
     */
    private void bindViews(){
        ivUsuario       = (ImageView)findViewById(R.id.ivUsuario);
        tvNome          = (TextView)findViewById(R.id.tvNome);
        tvEmail         = (TextView)findViewById(R.id.tvEmail);
        btnDesconectar  = (Button)findViewById(R.id.btnDesconectar);
        btnRevogar      = (Button)findViewById(R.id.btnRevogar);
        signInButton    = (SignInButton) findViewById(R.id.sign_in_button);
        // litener de clicks
        signInButton.setOnClickListener(this);
        btnDesconectar.setOnClickListener(this);
        btnRevogar.setOnClickListener(this);
    }

    /**
     * Metodo para fazer as primeiras requisições da API para login simples
     */
    private void obterConfiguracoesPadraoLogin(){
        GoogleSignInOptions gso = new GoogleSignInOptions.Builder(GoogleSignInOptions.DEFAULT_SIGN_IN)
                .requestEmail()
                .build();

        mGoogleApiClient = new GoogleApiClient.Builder(this)
                .enableAutoManage(this,this)
                .addApi(Auth.GOOGLE_SIGN_IN_API, gso)
                .build();

    }

    /**
     * metodo para inicar o login
     */
    private void signIn() {
        Intent signInIntent = Auth.GoogleSignInApi.getSignInIntent(mGoogleApiClient);
        startActivityForResult(signInIntent, SIGN_IN);
    }
    

    @Override
    public void onActivityResult(int requestCode, int resultCode, Intent data) {
        super.onActivityResult(requestCode, resultCode, data);

        if (requestCode == SIGN_IN) {
            GoogleSignInResult resultado = Auth.GoogleSignInApi.getSignInResultFromIntent(data);
            if (resultado.isSuccess()){
                GoogleSignInAccount acct = resultado.getSignInAccount();
                obterInfoGoogle(acct);
            }
        }
    }

    private void obterInfoGoogle(GoogleSignInAccount acct){
        String nome = acct.getDisplayName();
        tvNome.setText(nome);
        String email = acct.getEmail();
        tvEmail.setText(email);
        String id = acct.getId();
        Log.i(TAG,"ID do usuário no GooglePlus "+id);
        String urlFoto = acct.getPhotoUrl().toString();
        Picasso.with(MainActivity.this).load(urlFoto).resize(100,100).into(ivUsuario);
    }

    @Override
    public void onClick(View v) {
        switch (v.getId()){
            case R.id.sign_in_button:
                signIn();
                break;
            case R.id.btnDesconectar:
                break;
            case R.id.btnRevogar:
                break;
        }
    }

    @Override
    public void onConnectionFailed(ConnectionResult connectionResult) {
        Log.e(TAG,"onConnectionFailed "+connectionResult.getErrorMessage());
    }

}
</pre>

<p>Falta ainda fazer o <strong>desconectar</strong> e <strong>revogar</strong> acesso, estou deixando para próxima parte, até lá.</p>

    </article>

    <div class="tb-related-posts">
      <h3>Leia mais:</h3>
      <ul>
        
        <li class="tb-related-post">
          <a href="/jhonny-roger/public/indo-alem-no-react-native//?utm_source=tablelessRelatedLin">Indo além no Mundo React-Native</a><br />
        </li>

        
        <li class="tb-related-post">
          <a href="/jhonny-roger/public/velocidade-tableless-estatico//?utm_source=tablelessRelatedLin">Performance do Tableless estático</a><br />
        </li>

        
        <li class="tb-related-post">
          <a href="/jhonny-roger/public/seu-primeiro-bot-para-o-telegram//?utm_source=tablelessRelatedLin">Seu primeiro bot para o Telegram</a><br />
        </li>

        
      </ul>
    </div>

  </section>
</div>

<footer id="sd-footer">
</footer>

<script src="https://code.jquery.com/jquery-3.2.1.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
<script type="text/javascript" src="http://localhost/jhonny-roger/public/js/main.js?1500245841"></script>