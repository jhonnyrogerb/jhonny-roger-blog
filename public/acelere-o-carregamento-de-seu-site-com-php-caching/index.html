<!DOCTYPE html>
<html>
<head>
	<title>Sejedev - "Seje" dev, não seja sobrinho!</title>
	<meta charset="utf-8">
  	<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

	<link rel="stylesheet" type="text/css" href="http://localhost/jhonny-roger/public/css/style.min.css?1500245840">
	<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
	<script>
	  (adsbygoogle = window.adsbygoogle || []).push({
	    google_ad_client: "ca-pub-9403183739906461",
	    enable_page_level_ads: true
	  });
	</script>
</head>
<body>
	<header id="sd-header">
		<a href="http://localhost/jhonny-roger/public/" id="sd-logo">Sejedev</a>
		<nav id="sd-nav-menu">
			<ul>
				<li><a href="http://localhost/jhonny-roger/public/categories/nodejs">Artigos</a></li>
				<li><a href="http://localhost/jhonny-roger/public/categories/jquery">Noticias</a></li>
				<li><a href="http://localhost/jhonny-roger/public/categories/jquery">Projetos</a></li>
				<li><a href="http://localhost/jhonny-roger/public/categories/jquery">Colabore</a></li>
			</ul>
		</nav>
		<form action="#" id="sd-search-form">
			<input type="search" name="search" placeholder="Faça a sua busca!">
		</form>
	</header>
<section id="sd-main-post">
    
    <h1>
        <a href="/jhonny-roger/public/frontend-week/">
            Front-end Week
        </a>
    </h1>
    <p class="sd-main-excerpt">
         Uma overdose de eventos e palestras sobre front-end em uma semana. 
    </p>
    <p class="sd-main-author">
        por <a href="/jhonny-roger/public/author/diego-eis">Diego Eis"</a>27/06/2017
    </p>
    
</section>



<div class="tb-post">

  <section class="tb-post-content">
    <article class="tb-post-article">
      

<p><span style="font-weight: 400">Criar um site dinâmico, de fácil manutenção e que carregue rápido é o desejo de todo desenvolvedor, mas para isso não existe uma fórmula mágica, é necessário conciliar diferentes ferramentas e técnicas. </span></p>

<p><span style="font-weight: 400">Mas muitos desenvolvedores iniciantes em PHP não conhecem as soluções existentes ou tem medo da curva de aprendizado que os frameworks exigem.</span></p>

<p><span style="font-weight: 400">O foco desse artigo é mostrar para esses desenvolvedores como uma técnica simples, utilizando apenas comandos básicos do PHP, pode acelerar o carregamento de seu site e evitar que ele fique caindo.</span></p>

<h3 id="o-problema-a-ser-resolvido-processamento-desnecessário">O problema a ser resolvido, processamento desnecessário</h3>

<p><span style="font-weight: 400">Para cada acesso a um site dinâmico, o servidor geralmente realiza consultas no banco de dados, executa blocos de códigos e entrega uma página pronta para exibição.</span></p>

<p><span style="font-weight: 400">Mesmo que os acessos a uma página ocorram com poucos segundos de diferença e nada no conteúdo tenha sido alterado, o servidor irá fazer o mesmo processo para cada solicitação, quantas vezes for preciso.</span></p>

<p><span style="font-weight: 400">Isto é um trabalho desnecessário e que exige muito processamento do servidor, principalmente em momentos de tráfego intenso, e se o servidor não der conta, o seu site ficará temporariamente fora do ar.</span></p>

<h3 id="a-solução-php-caching">A solução, PHP Caching</h3>

<p><span style="font-weight: 400">Também conhecido como Cache de Objetos, essa técnica executa uma página PHP e armazena o conteúdo gerado em um arquivo HTML, e para os próximos acessos, durante um certo período, o servidor irá entregar esse HTML gerado.</span></p>

<p><span style="font-weight: 400">Sem a necessidade de consultar o banco de dados ou executar algum tipo de programação para montar a página, o servidor além de conseguir entregar uma página mais rapidamente, também suportará um número maior de acessos concorrentes.</span></p>

<h3 id="qual-o-ganho-na-performance"><strong>Qual o ganho na performance?</strong></h3>

<p><span style="font-weight: 400">Vai depender muito da programação do site, mas quanto mais ações forem realizadas no backend, maior será o ganho. Veja abaixo os resultados obtidos durante um teste:</span></p>

<p><img class="aligncenter wp-image-55365 size-full" src="http://tableless.com.br/uploads/2016/07/phpcaching-benchmarks.jpg" width="1180" height="393" />A versão dinâmica foi entregue em 318 ms e a versão cacheada em 14 ms, 23 vezes mais rápido.</p>

<h2 id="desenvolvimento">Desenvolvimento</h2>

<p><span style="font-weight: 400">Chega de teoria e vamos para a prática, criaremos juntos um exemplo que seja o mais simples possível.</span></p>

<p><span style="font-weight: 400">Primeiro crie uma pasta no seu ambiente de desenvolvimento chamada <code>phpcaching</code>, dentro dela crie outras duas pastas, uma chamada <code>paginas</code> onde iremos armazenar as páginas dinâmicas em PHP e outra chamada <code>cache</code> que irá armazenar os arquivos HTML.</span></p>

<p><span style="font-weight: 400">Dentro da pasta <code>paginas</code> crie um arquivo chamado <code>index.php</code>, com o código:</span></p>

<pre><span style="font-weight: 400">&lt;!DOCTYPE html&gt;</span>
<span style="font-weight: 400">&lt;html&gt;</span>
<span style="font-weight: 400">&lt;head&gt;</span>
<span style="font-weight: 400">    &lt;meta charset="utf-8"&gt;</span>
<span style="font-weight: 400">    &lt;title&gt;PHP Caching&lt;/title&gt;</span>
<span style="font-weight: 400">&lt;/head&gt;</span>
<span style="font-weight: 400">&lt;body&gt;</span>
<span style="font-weight: 400">    &lt;p&gt;Página gerada em: &lt;?php echo date('H:i:s') ?&gt;&lt;/p&gt;</span>
<span style="font-weight: 400">&lt;/body&gt;</span>
<span style="font-weight: 400">&lt;/html&gt;</span>
</pre>

<p><span style="font-weight: 400">Teste a página que acabamos de criar, acessando ela pelo navegador, no meu caso o endereço é: <code><a href="http://localhost/phpcaching/paginas/index.php">http://localhost/phpcaching/paginas/index.php</a></code></span></p>

<p><span style="font-weight: 400">Você verá uma página simples, que apenas mostra o horário atual toda vez que é acessada.</span></p>

<p><span style="font-weight: 400">Agora vamos criar o nosso controlador de cache, que irá funcionar da seguinte maneira:</span></p>

<p><img class="aligncenter wp-image-55366 " src="http://tableless.com.br/uploads/2016/07/phpcaching-diagrama-de-atividades.jpg" width="551" height="551" /></p>

<p><span style="font-weight: 400">Sabendo a lógica de funcionamento, fica mais fácil programar nosso controlador. Crie na raiz do projeto um arquivo chamado <code>index.php</code> com o seguinte código:</span></p>

<pre class="lang-php">&lt;?php
// Configurações
$validadeEmSegundos = 60;
$arquivoCache = 'cache/index.html';
$urlDinamica = 'http://localhost/phpcaching/paginas/index.php';

// Verifica se o arquivo cache existe e se ainda é válido
if (file_exists($arquivoCache) && (filemtime($arquivoCache) &gt; time() - $validadeEmSegundos)) {

    // Lê o arquivo cacheado
    $conteudo = file_get_contents($arquivoCache);
} else {

    // Acessa a versão dinâmica
    $conteudo = file_get_contents($urlDinamica);

    // Cria o cache
    file_put_contents($arquivoCache, $conteudo);
}

// Exibe o conteúdo da página
echo $conteudo;
</pre>

<p><span style="font-weight: 400">Vou explicar as funções utilizadas para caso você não conheça alguma delas:</span></p>

<p><span style="font-weight: 400"><code>file_exists</code>: verifica se um arquivo existe</span></p>

<p><span style="font-weight: 400"><code>file_get_contents</code>: lê o conteúdo de um arquivo</span></p>

<p><span style="font-weight: 400"><code>file_put_contents</code>: escreve o conteúdo em um arquivo</span></p>

<p><span style="font-weight: 400"><code>filemtime</code>: retorna o horário que o arquivo foi modificado</span></p>

<p><span style="font-weight: 400"><code>time</code>: retorna o horário atual</span></p>

<p><span style="font-weight: 400">Agora acesse o site através do controlador de cache, no meu caso <code><a href="http://localhost/phpcaching/">http://localhost/phpcaching/</a></code></span></p>

<p><span style="font-weight: 400">Repare que o horário aparece como anteriormente, mas se atualizarmos a página o horário não muda. Isto acontece porque a página exibida é a versão cacheada, que foi armazenada na pasta <code>cache</code> com o nome <code>index.html</code>.</span></p>

<p>Pronto, nossa solução para cachear páginas está criada.</p>

<h2 id="conclusão">Conclusão</h2>

<p><span style="font-weight: 400">Esta técnica é uma maneira eficaz de aumentar a performance de seu site, sem precisar instalar algo no servidor ou algum framework no seu projeto e é recomendada para quem está iniciando no assunto.</span></p>

<p><span style="font-weight: 400">O código apresentado não é uma solução definitiva, mas uma base que podemos expandir de acordo com as necessidades de cada projeto, crie sua versão melhorada, faça um teste com um projeto que você já possua e analise a diferença no tempo de carregamento do site.</span></p>

<p><span style="font-weight: 400">Eu utilizo essa técnica em um portal de notícias da minha região, e apesar do site já ter sido migrado de servidor algumas vezes, o código nunca precisou de alteração, essa é a vantagem de utilizar apenas comandos básicos do PHP.</span></p>

<p><span style="font-weight: 400">Continuem os estudos e que a performance esteja com você.</span></p>

    </article>

    <div class="tb-related-posts">
      <h3>Leia mais:</h3>
      <ul>
        
        <li class="tb-related-post">
          <a href="/jhonny-roger/public/silex-2-middlewares-101-parte-02//?utm_source=tablelessRelatedLin">Silex 2 &amp; Middlewares 101 – Parte 02</a><br />
        </li>

        
        <li class="tb-related-post">
          <a href="/jhonny-roger/public/codigo-limpo-escreva-seu-codigo-hoje-sem-esquecer-da-manutencao-de-amanha//?utm_source=tablelessRelatedLin">Código Limpo – Escreva seu código hoje sem esquecer da manutenção de amanhã</a><br />
        </li>

        
        <li class="tb-related-post">
          <a href="/jhonny-roger/public/upload-de-arquivos-com-upin//?utm_source=tablelessRelatedLin">Upload de Arquivos com a Upin</a><br />
        </li>

        
      </ul>
    </div>

  </section>
</div>

<footer id="sd-footer">
</footer>

<script src="https://code.jquery.com/jquery-3.2.1.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
<script type="text/javascript" src="http://localhost/jhonny-roger/public/js/main.js?1500245840"></script>